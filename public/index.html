<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HACK SLOT</title>
    <link rel="stylesheet" href="/css/global.css">
    <link rel="stylesheet" href="/css/login.css">
</head>
<body class="full-page">

    <canvas id="matrix-canvas"></canvas>

    <div class="digital-frame-corner corner-tl"></div>
    <div class="digital-frame-corner corner-tr"></div>
    <div class="digital-frame-corner corner-bl"></div>
    <div class="digital-frame-corner corner-br"></div>

    <div class="login-container fadeIn">
        <div class="login-promo-panel">
            <img src="/assets/images/promo.gif" alt="Promo Animation">
        </div>
        <div class="login-form-panel">
            <form id="login-form">
                <h2>Đăng Nhập</h2>
                <p class="slogan-text">TOOL HỖ TRỢ TẤT CẢ CÁC SẢNH</p>
                <div class="form-group"><input type="text" id="login-username" placeholder="Tên đăng nhập" required></div>
                <div class="form-group"><input type="password" id="login-password" placeholder="Mật khẩu" required></div>
                <button type="submit" class="btn-primary">Đăng nhập</button>
            </form>
            <form id="register-form" style="display: none;">
                <h2>Tạo Tài Khoản</h2>
                <p class="slogan-text">TOOL HỖ TRỢ TẤT CẢ CÁC SẢNH</p>
                <div class="form-group"><input type="text" id="register-username" placeholder="Tên đăng nhập" required></div>
                <div class="form-group"><input type="password" id="register-password" placeholder="Mật khẩu" required></div>
                <div class="form-group"><input type="password" id="register-password-confirm" placeholder="Nhập lại mật khẩu" required></div>
                <button type="submit" class="btn-primary">Đăng ký</button>
            </form>
            <button id="toggle-btn" class="btn-secondary" style="margin-top: 15px;">Chưa có tài khoản? Đăng ký</button>
            <p id="message"></p>
        </div>
    </div>
    
    <script>
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');
        const toggleBtn = document.getElementById('toggle-btn');
        const messageEl = document.getElementById('message');

        toggleBtn.addEventListener('click', () => {
            if (loginForm.style.display === 'none') {
                loginForm.style.display = 'block';
                registerForm.style.display = 'none';
                toggleBtn.textContent = 'Chưa có tài khoản? Đăng ký';
            } else {
                loginForm.style.display = 'none';
                registerForm.style.display = 'block';
                toggleBtn.textContent = 'Đã có tài khoản? Đăng nhập';
            }
        });

        registerForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const username = document.getElementById('register-username').value;
            const password = document.getElementById('register-password').value;
            const confirmPassword = document.getElementById('register-password-confirm').value;

            if (password !== confirmPassword) {
                messageEl.textContent = 'Mật khẩu nhập lại không khớp!';
                messageEl.className = 'error';
                return;
            }

            const response = await fetch('/api/register', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, password })
            });
            const data = await response.json();
            messageEl.textContent = data.message;
            messageEl.className = data.success ? 'success' : 'error';
            if (data.success) {
                setTimeout(() => {
                    window.location.reload();
                }, 1500);
            }
        });

        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;
            const response = await fetch('/api/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, password })
            });
            const data = await response.json();
            if (data.success) {
                localStorage.setItem('username', username);
                if (data.isAdmin) {
                    localStorage.setItem('adminId', data.userId);
                    // === ĐÃ SỬA: Lưu trạng thái Super Admin ===
                    localStorage.setItem('isSuperAdmin', data.isSuperAdmin); 
                }
                window.location.href = data.isAdmin ? '/admin.html' : '/brand-selection.html';
            } else {
                messageEl.textContent = data.message;
                messageEl.className = 'error';
            }
        });

        const canvas = document.getElementById('matrix-canvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        const numbers = '0123456789';
        const fontSize = 16;
        const columns = canvas.width / fontSize;
        const drops = Array(Math.floor(columns)).fill(1);

        function draw() {
            ctx.fillStyle = 'rgba(248, 249, 250, 0.1)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = 'rgba(217, 4, 41, 0.7)';
            ctx.font = `${fontSize}px Arial`;
            for (let i = 0; i < drops.length; i++) {
                const text = numbers.charAt(Math.floor(Math.random() * numbers.length));
                ctx.fillText(text, i * fontSize, drops[i] * fontSize);
                if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) {
                    drops[i] = 0;
                }
                drops[i]++;
            }
        }
        setInterval(draw, 50);
        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });
    </script>
</body>
</html>