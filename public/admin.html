<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
     <title>Wukong Slot</title>
    <link rel="icon" type="image/png" href="/assets/images/favicon.png">
    <link rel="stylesheet" href="/css/global.css">
    <link rel="stylesheet" href="/css/admin.css">
    <link rel="manifest" href="/manifest.json">
</head>
<script>
    // === BẮT BUỘC KIỂM TRA ĐĂNG NHẬP ===
    if (!localStorage.getItem('username')) {
        window.location.href = '/'; // Chuyển về trang đăng nhập
    }
</script>
<body class="admin-page">
    <header class="header fadeIn">
        <div></div> 
        <div class="header-right-group">
            <div id="admin-coin-display">Token: ...</div>
            <button class="logout-button">
                 <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>
                <span>Đăng Xuất</span>
            </button>
        </div>
    </header>

    <main class="fadeIn admin-main-container">
        <h1>Bảng Điều Khiển Admin</h1>
        
        <!-- === BẮT ĐẦU: KHUNG HIỂN THỊ THÔNG BÁO === -->
        <div id="system-notification-box" style="display: none; background: #fff3cd; border: 1px solid #ffeeba; color: #856404; padding: 15px; border-radius: 8px; margin-top: 20px; align-items: center; gap: 10px;">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path><path d="M13.73 21a2 2 0 0 1-3.46 0"></path></svg>
            <div>
                <strong style="display: block; margin-bottom: 5px;">Thông báo từ Hệ thống:</strong>
                <span id="system-notification-content">...</span>
            </div>
        </div>
        <!-- === KẾT THÚC KHUNG HIỂN THỊ THÔNG BÁO === -->

        <div class="grid-container" style="margin-top: 50px;">
            <!-- Menu này chỉ Super Admin mới thấy -->
            <a href="/super_admin_manage_admins.html" class="admin-menu-card" id="manage-admins-menu" style="display: none;">
                <div class="icon">
                   <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
               </div>
               <h3>Quản Lý Admin</h3>
               <p>Tạo và cấp Token cho các tài khoản Admin phụ.</p>
           </a>

            <!-- Menu này tất cả Admin đều thấy -->
            <a href="/admin_users.html" class="admin-menu-card">
                 <div class="icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
                </div>
                <h3>Quản Lý User</h3>
                <p>Cấp Token và quản lý tài khoản người dùng.</p>
            </a>

            <!-- Menu này cũng chỉ Super Admin mới thấy -->
            <a href="/admin_games.html" class="admin-menu-card" id="manage-games-menu" style="display: none;">
                <div class="icon">
                     <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg>
                </div>
                <h3>Quản Lý Game</h3>
                <p>Tạo sảnh game và thêm các trò chơi.</p>
            </a>
        </div>
    </main>

    <script>
        async function fetchAdminInfo() {
            const username = localStorage.getItem('username');
            const coinDisplay = document.getElementById('admin-coin-display');
            if (localStorage.getItem('isSuperAdmin') === 'true' || !coinDisplay) {
                if(coinDisplay) coinDisplay.style.display = 'none';
                return;
            };

            const response = await fetch(`/api/user-info?username=${username}`);
            const data = await response.json();
            if (data.success) {
                coinDisplay.textContent = `Token còn lại: ${data.userInfo.coins}`;
            }
        }

        async function checkSystemNotification() {
            try {
                const res = await fetch('/api/system-message');
                const data = await res.json();
                
                const box = document.getElementById('system-notification-box');
                const contentSpan = document.getElementById('system-notification-content');

                // Chỉ hiện nếu có nội dung
                if (data.success && data.content && data.content.trim() !== "") {
                    contentSpan.textContent = data.content;
                    box.style.display = 'flex'; // Hiện khung thông báo
                } else {
                    box.style.display = 'none'; // Ẩn nếu rỗng
                }
            } catch (e) { console.error("Lỗi tải thông báo", e); }
        }

        window.onload = () => {
            const isSuperAdmin = localStorage.getItem('isSuperAdmin') === 'true';

            // Logic kiểm tra quyền Super Admin
            if (isSuperAdmin) {
                document.getElementById('manage-admins-menu').style.display = 'block';
                document.getElementById('manage-games-menu').style.display = 'block';
            }

            fetchAdminInfo();
            checkSystemNotification();
        };

        document.querySelector('.logout-button').addEventListener('click', () => {
            localStorage.clear();
            window.location.href = '/';
        });
    </script>
    <script src="/js/global.js"></script>
</body>
</html>